# Shoken Automation Project

## 概要

生徒一人ひとりのよかったところを GPT で自動生成し、Excel ファイルに書き込む Python ツールです。
Excel に記載された生徒情報（学年、出席番号、よかったところ等）を元に、OpenAI の API を使って個別コメントを自動生成します。

## 背景

私は前職で東京都の公立中学校の教員をしておりました。
通知表作成の時期になると、クラス担任は40人近くの所見の作成に追われます。
一からすべて作成すると膨大な時間になるため、4月から書き始める教員もいるような状態で、学期全体を見渡した所見を作成することが困難な状況がありました。
それでは学期末になって変わり始めた生徒の様子の見取りを所見に反映できず、生徒や家庭に評価としてつたえることができません。
そのため、教員が手を入れることは前提ですが、クラス人数分の個別のたたき台の作成をAIに委託することができないかと思い、システムの開発を行いました。

また、更なる経験と学習のため、転職を行うことを考えているため、このシステムを転職活動のポートフォリオとすることに決めました。

## フォルダ構成
```
shoken-automation-project/
├── main.py # 実行ファイル。uiの起動などを定義しています。
├── config.py # 設定ファイルです。ここでenvを読み取ったりします。
├── controller/
│ └── generate_controller.py # 所見生成までのロジックの流れを定義しています。
├── domain/
│ └── student_record.py # Record ドメインモデル
├── service/
│ └── comment_service.py # コメント生成処理
├── util/
│ └── prompt_builder.py # プロンプト構築
├── infra/
│ └── excel_io.py # Excel 読み書き処理
├── tests/
│ └──integration/
│   └──test_integration_flow.py # 結合テストです。ダミーのExcelファイルを作成し、読み取り、書き出しを行います。APIでのコメント生成はモックです。
│ └──unit/
│   └──test_comment_service.py # 所見生成の戻り値の方などをテストする単体テストです
│   └──test_prompt_builder.py # 所見生成のためのプロンプト作成の単体テストです
├── ui/
│ └── main_window.py # 起動時の画面をTkinterで作成しています。
├── .env # 環境変数の設定（gitignore ではじいています。）
├── .env.example # .env のサンプルです。
├── .gitignore
└── README.md # このファイル
```
## 必要環境

- Python 3.10 以上
- pip（または uv/poetry 等）
- インターネット接続（OpenAI API 利用時）

## Excel フォーマット

- ブック名：任意です
- シート名：input #今後変えます
- A 列：学年（一文目が変化します）
- B 列：クラス(システム的には使いません)
- C 列：出席番号(API に名前を投げたくないので。)
- D,E,F 列：よかったところなど。所属委員会や部活動などを入れてもいいです。皮肉はききません。
- G 列：所見が書き出されます。

## 環境変数の設定

プロジェクトルートに `.env` を作成し、以下を設定してください。

OPENAI_API_KEY=sk-xxxxx
または、OPENAI_BASE_URL=https://api.openai.com/v1（自前のプロキシなどを使う場合）

モデル/温度の上書き
OPENAI_MODEL=gpt-4o
（省略時プリセット: smart=gpt-4o, fast=gpt-4o-mini, vision=gpt-4o-mini）
OPENAI_TEMPERATURE=0.7
`.env.example` を参考にしてください。

## 使い方
コンソールにて
python main.py
1.「ファイルを選択」から Excel を選ぶ（ブック名は任意、シート名は input）。
2.「実行」を押すと生成が始まり、進捗バーが増えていきます。
3.完了後、所見が Excel に書き戻されます（既定は G 列）。

## テストについて
すべてのテスト
pytest -q

カバレッジ（任意）
pip install coverage
coverage run -m pytest
coverage report -m

## 課題
一区切りついたため、いったんの完成としましたが、課題点は多数あるため、リストアップします。
今後の学習によって完全なものにしていきます。
- システムの課題
  依存性の管理が不十分で、仕様の変更の際の更新に課題があると感じています。
  Pythonの依存性の注入についての学習を進める必要があります。
  また、例外処理が「コメントの生成に失敗した」という一点のみで、
  APIの接続ができなかったのか、プロンプトの作成に失敗したのか、などの状況がわからない状態になってしまっています。
  Excelのひな型を生成する機能が実装されるとユーザーが使いやすくなります。

- UIの課題
  一部生徒のみ生成しなおしたい、というニーズが生まれることが予想されますが、そういった機能が実装できていません。
  例外の状況がユーザーから見えないため、処理が達成されなかった場合、ユーザーがどうしていいかわかりません。
  無駄な領域が広く、デザインが洗練されていない。この件に関しては、今後の機能拡充に伴って修正を加えます。
